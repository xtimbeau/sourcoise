<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exec a script and cache results on disk • sourcoise</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Exec a script and cache results on disk">
<meta name="description" content="sourcoise provides a function that behave nearly as base::source() but implements a caching mechanism on disk. It allows to quasi source() R scripts that gather data but can fail or consume to much time to respond even if nothing new is expected. It comes with a bunch of tools to check and execute on demand or when cache is invalid the script.">
<meta property="og:description" content="sourcoise provides a function that behave nearly as base::source() but implements a caching mechanism on disk. It allows to quasi source() R scripts that gather data but can fail or consume to much time to respond even if nothing new is expected. It comes with a bunch of tools to check and execute on demand or when cache is invalid the script.">
<meta property="og:image" content="https://xtimbeau.github.io/sourcoise/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">sourcoise</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/sourcoise.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/advanced.html">Usages avancés</a></li>
    <li><a class="dropdown-item" href="articles/compared.html">Comparé à ...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="sourcoise-">sourcoise 
<a class="anchor" aria-label="anchor" href="#sourcoise-"></a>
</h1>
</div>
<p><a href="https://xtimbeau.github.io/sourcoise">sourcoise</a> est un package qui fournit des outils pour exécuter un script R et mettre en cache les résultats. Le but est de pouvoir exécuter très rapidement un code qui accède à des fichiers ou une API et qui, en l’absence de mises à jour, produit toujours le même résultat. Lorsque l’API est suceptible de bloquer (ou si on a pas de connection internet), cela évite de bloquer le rendu d’un document ou d’un site quarto.</p>
<p>Accessoirement, cela oblige à isoler le code du script qui récupère les données dans un fichier afin d’améliorer la reproductibilité. <code><a href="reference/sourcoise.html">sourcoise()</a></code> peut être appelé dans un <code><a href="reference/sourcoise.html">sourcoise()</a></code> ce qui permet la modularité. Il fournit des outils pour vérifier le cache et le rafraichir à la demande.</p>
<div class="section level2">
<h2 id="installation">installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Pour installer <a href="https://xtimbeau.github.io/sourcoise">sourcoise</a> il faut le faire depuis <em>github</em> :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_gitub</span><span class="op">(</span><span class="st">"xtimbeau/sourcoise"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># alternativement</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"xtimbeau/sourcoise"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utilisation">utilisation<a class="anchor" aria-label="anchor" href="#utilisation"></a>
</h2>
<p>Pour alimenter un graphique ou un tableau en données, on met le code dans un script <code>r</code> (“mon_script.r”) en terminant le script par un <code>return(data_pour_le_graphique)</code>. Dans le <code>.qmd</code> ou <code>.rmd</code> (ou aussi un scirpt R) on a les instructions du graphique :</p>
<pre class="qmd"><code>```{r}
library(sourcoise)
mes_datas &lt;- sourcoise("mon_script.r")
ggplot(mes_datas) + instructions du graphique

```</code></pre>
<p>A la première exécution le script est exécuté, les appels suivants utiliseront le cache, sauf si le cache est invalidé.</p>
</div>
<div class="section level2">
<h2 id="bénéfices">bénéfices<a class="anchor" aria-label="anchor" href="#b%C3%A9n%C3%A9fices"></a>
</h2>
<p>Les bénéfices sont nombreux :</p>
<ol style="list-style-type: decimal">
<li><p>un gain de temps lorsque l’exécution du code est longue (accès à une API, téléchargement de grosses données, traitements importants). La lecture d’un fichier excel peut aussi être assez longue. Le temps d’accès aux données en cache dépend de leur taille, mais même pour des données volumineuses (et il n’y a pas de raisons qu’elles le soient tant que ça), l’ordre de grandeur est de qualques millisecondes, grâce aux optimisations.</p></li>
<li><p>le cache est transférable par github. Il se trouve dans un dossier (caché), mais enregistré dans le dossier de projet et <em>commité</em> par github. Le cache produit sur un poste est donc accessible par <code>pull</code> sur les autres postes.</p></li>
<li><p>si le code source déclenche une erreur, on peut passer outre : En cas de package non installé, données absentes (par exemple un chemin absolu dans le code), ou une API qui bloque (comme celle de l’OCDE) alors <code><a href="reference/sourcoise.html">sourcoise()</a></code> essaye de prendre la dernière exécution résussie. Bien que cela puisse être problématique, c’est-à-dire une erreur non signalée, cela a l’énorme avantage de ne pas bloquer le processus et de permettre de traiter l’erreur en parallèle.</p></li>
<li><p><code><a href="reference/sourcoise.html">sourcoise()</a></code> cherche de façon astucieuse le fichier source dans le projet et exécute le code dans un environnement local, en changeant le répertoire de travail pour être celui où se trouve le code source. Cela permet d’appeler dans le code source (le script <code>r</code> <code>mon_script.r</code> passé en paramètre à <code>sourcoise("mon_script.r")</code>, des scripts <code>r</code>, des fichiers de données <code>.csv</code> ou <code>.xlsx</code> qui sont enregistré dans le même répertoire que le fichier <code>mon_script.r</code>. On peut donc réutiliser le code sans se soucier de modifier les chemins qui sont relatifs au dossier où se trouve <code>mon_script.r</code>.</p></li>
<li><p>cela fournit un embryon de reproductibilité en désignant le script qui fabrique les données.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="à-venir">à venir<a class="anchor" aria-label="anchor" href="#%C3%A0-venir"></a>
</h2>
<p>Seront bientôt implémentés :</p>
<ul>
<li><p>la possibilité de stocker les données cachées hors du dossier de projet (et donc hors de <em>github</em>) et d’utiliser <a href="https://pins.rstudio.com/" class="external-link">pins</a> pour le stcokage (mais peut être au prix d’un accès plus lent).</p></li>
<li><p>un schéma pour déclarer les dépendances entre dess appels à <code><a href="reference/sourcoise.html">sourcoise()</a></code> et déclencher les exécutions en cascade.</p></li>
<li><p>et éventuellement une interface <em>shiny</em> de mise à jour (<em>gui</em> pour <code><a href="reference/sourcoise_refresh.html">sourcoise_refresh()</a></code>)</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sourcoise</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Xavier Timbeau <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xavier Timbeau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
