<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>sources code and caches results — sourcoise • sourcoise</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sources code and caches results — sourcoise"><meta name="description" content="sourcoise() is used as a drop in replacement for base::source() but caches results on disk. Cache is persistant."><meta property="og:description" content="sourcoise() is used as a drop in replacement for base::source() but caches results on disk. Cache is persistant."><meta property="og:image" content="https://xtimbeau.github.io/sourcoise/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sourcoise</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/sourcoise.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>sources code and caches results</h1>

      <div class="d-none name"><code>sourcoise.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>sourcoise()</code> is used as a drop in replacement for <code><a href="https://rdrr.io/r/base/source.html" class="external-link">base::source()</a></code> but caches results on disk. Cache is persistant.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sourcoise</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  track <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lapse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.lapse"</span><span class="op">)</span>,</span>
<span>  force_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.force_exec"</span><span class="op">)</span>,</span>
<span>  prevent_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.prevent_exec"</span><span class="op">)</span>,</span>
<span>  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.metadata"</span><span class="op">)</span>,</span>
<span>  wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.wd"</span><span class="op">)</span>,</span>
<span>  src_in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.src_in"</span><span class="op">)</span>,</span>
<span>  exec_wd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nocache <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.log"</span><span class="op">)</span>,</span>
<span>  grow_cache <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.grow_cache"</span><span class="op">)</span>,</span>
<span>  limit_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sourcoise.limit_mb"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>(character) le chemin vers le code à exécuter (sans extension .r ou .R ou avec au choix), ce chemin doit être relatif au projet (voir détails)</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>(list) une liste d'arguments que l'on peut utliser dans source (args$xxx)</p></dd>


<dt id="arg-track">track<a class="anchor" aria-label="anchor" href="#arg-track"></a></dt>
<dd><p>(list) une liste de fichiers (suivant la même règle que src pour les trouver) qui déclenchent l'exécution.</p></dd>


<dt id="arg-lapse">lapse<a class="anchor" aria-label="anchor" href="#arg-lapse"></a></dt>
<dd><p>(character) peut être "never" (défaut) "x hours", "x days", "x weeks", "x months", "x quarters", "x years"</p></dd>


<dt id="arg-force-exec">force_exec<a class="anchor" aria-label="anchor" href="#arg-force-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code est exécuté.</p></dd>


<dt id="arg-prevent-exec">prevent_exec<a class="anchor" aria-label="anchor" href="#arg-prevent-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code n'est pas exécuté, ce flag est prioritaire sur les autres, sauf si il n'y a pas de données en cache</p></dd>


<dt id="arg-metadata">metadata<a class="anchor" aria-label="anchor" href="#arg-metadata"></a></dt>
<dd><p>(boléen) Si TRUE (FALSE par défaut) la fonction retourne une liste avec des métadonnées et le champ data qui contient les données elles même</p></dd>


<dt id="arg-wd">wd<a class="anchor" aria-label="anchor" href="#arg-wd"></a></dt>
<dd><p>(character) si 'project' assure que le wd est le root du project, si 'file' (défaut) c'est le fichier sourcé qui est le wd, si "qmd", c'est le qmd qui appelle</p></dd>


<dt id="arg-src-in">src_in<a class="anchor" aria-label="anchor" href="#arg-src-in"></a></dt>
<dd><p>(character) si "project" cherche le source dans le projet puis les sous dossiers, si "file" cherche dans le dossier du qmd (ou le wd). Dans ce cas, les données sont stockées dans le dossier en question.</p></dd>


<dt id="arg-exec-wd">exec_wd<a class="anchor" aria-label="anchor" href="#arg-exec-wd"></a></dt>
<dd><p>(character) NULL par défaut sauf usage particulier</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>(character) force le root (usage non recommandé)</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(boléen) pas de messages</p></dd>


<dt id="arg-nocache">nocache<a class="anchor" aria-label="anchor" href="#arg-nocache"></a></dt>
<dd><p>(boléen) n'enregistre pas le cache même si nécessaire</p></dd>


<dt id="arg-log">log<a class="anchor" aria-label="anchor" href="#arg-log"></a></dt>
<dd><p>("OFF" par défaut) niveau de cache (voir <code>logger::log_treshold()</code>)</p></dd>


<dt id="arg-grow-cache">grow_cache<a class="anchor" aria-label="anchor" href="#arg-grow-cache"></a></dt>
<dd><p>(5 par défaut) stratégie de cache</p></dd>


<dt id="arg-limit-mb">limit_mb<a class="anchor" aria-label="anchor" href="#arg-limit-mb"></a></dt>
<dd><p>(50 par défaut) limite le fichier de données à x mb (pour github). Si au dessus de la limite, <strong>pas de cache</strong>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data (list ou ce que le code retourne)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>However, there are some minor differences. First, the script called in <code>sourcoise()</code> must end by a <code><a href="https://rdrr.io/r/base/function.html" class="external-link">return()</a></code> or by an object returned.
Second, the script is always executed in a local environment, and the working directory is changed to be the one of the script.
Third, an heuristic is applied to find the script, evnt is the path given is incomplete. The closer to the working directory at the moment of the call will be prefered.
Fourth, in cas of an error is triggered by the script, <code>sourcoise()</code> does not fail and return the error, except if cached data is found and returned. In any case, the error is logged.</p>
<p>Cache is invalidated when :
1 -   a cache is not found
2 -   the script has been modified
3 -   tracked files have been modified
4 -   last execution occurred a certan time ago and is considered as experied
5 -   execution is forced</p>
<p>Si le paramètre <code>src_in</code> est <code>"file"</code>, alors le source est cherché à partir du qmd (ou du wd si il n'y pas qmd) et les données sont stockées à ce niveau.
Ce cas correspond donc à des dossiers qui ne partagent pas de code (i.e. le blog de l'OFCE), alors que l'autre cas correspond à des codes pouvant être partagés (la prévision)</p>
<p>Le code est execute (dans un environnement local) et le resultat est mis en cache. Il est important que le code se termine par un return(les_donnees).
le code est exécuté avec un contrôle d'erreur, donc si il bloque, "NULL" est renvoyé, mais sans erreur ni arrêt.
les appels suivants seront plus rapides et sans erreur (sauf si l'erreur n'est pas corrigée).</p>
<p>Une modification du code est détectée, invalide le cache et déclenche l'éxécution si sourcoise est exécutée.</p>
<p>Suivant le paramètre lapse on peut déclencher une exécution périodique.
Par exemple, pour ne pas rater une MAJ, on peut mettre <code>lapse = "1 day"</code> ou <code>"day"</code> et une fois par jour le code sera exécuté.
Cela permet d'éviter une exécution à chaque rendu, mais permet de vérifier fréquemment la MAJ.
On peut spécifier l'intervalle en heures (<code>hours</code>), en jours (<code>days</code>), en semaines (<code>weeks</code>), en mois (<code>months</code>) ou en trimestres (<code>quarters</code>).</p>
<p>Des métadonnées peuvent être renvoyées (paramètre <code>metadata</code>) avec la date de la dernière exécution (<code>$date</code>), le temps d'exécution (<code>$timing</code>),
la taille des données (<code>$size</code>), le chemin de la source (<code>$where</code>), le hash du source (<code>$hash_src</code>) et bien sûr les données (<code>$data</code>).
Cela peut servir pour renseigner un graphique.</p>
<p>Le paramètre <code>wd</code> perment de spécifier le répertoire d'exécution du source.
Si il est mis à <code>"file"</code>, les appels à l'intérieur du code source, comme par exemple un save ou un load seront compris dans le répertoire où se trouve le fichier source.
L'intérêt est que le code peut avoir des éléments persistants, locaux
L'alternative est d'utiliser <code>wd="project"</code> auquel cas, le répertoire d'exécution sera independant de l'endroit où est appelé le code source.
Les éléments persistants peuvent alors être dasn un endroit commun et le code peut appeler des éléments persistants d'autres codes sources.
En le mettant à <code>qmd</code>l'exécution part du fichier qmd, ce qui est le comportement standard de <code>quarto</code>.
Toute autre valeur pour wd laisse le working directory inchnagé et donc dépendant du contexte d'exécution. Pour ceux qui aiment l'incertitude.</p>
<p>En donnant des fichers à suivre par <code>track</code>, on peut déclencher l'exécution du source lorsque ces fichiers sont modifiés, c'est utile pour des fichiers sources sous excel (ou csv).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other sourcoise:
<code><a href="sourcoise_clear.html">sourcoise_clear</a>()</code>,
<code><a href="sourcoise_refresh.html">sourcoise_refresh</a>()</code>,
<code><a href="sourcoise_reset.html">sourcoise_reset</a>()</code>,
<code><a href="sourcoise_status.html">sourcoise_status</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xavier Timbeau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

